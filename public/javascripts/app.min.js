function elemIsArray(a,b,c){var d;if(a=a.trim(),Array.isArray(a.split(" "))&&a.split(" ").length>1){var e=a.split(" ");e.forEach(capitalize),c[b]=e.join(" ")}else a=capitalize(a),c[b]=a.toString();return d=c.join(",")}function capitalize(a,b,c){a=a.trim();var d;d=c?c:void 0;var e=[],f="";if("of"!==a&&"the"!==a||0==b){for(var g=0;g<=a.length;g++)e.push(a[g]);f=e[0].toUpperCase(),e.shift(),e.unshift(f),a=e.join("")}else;return c?c[b]=a:(c=[],c.push(a)),c}function openModal(a){if("LatestEventModalCtrl"!==a.modal.contr||a.$scope.event){a.$modal.open({scope:a.$scope,animation:a.$scope.animationsEnabled,templateUrl:a.modal.templ,controller:a.modal.contr,size:a.size})}else;}var app=angular.module("myApp",["ngRoute","ui.bootstrap","ngAnimate","ngFileUpload","simpleAngularTicker"]);app.config(function(a,b){b.html5Mode(!0),a.when("/login",{templateUrl:"views/newLogin.html",controller:"indexCtrl"}).when("/admin",{templateUrl:"views/admin.html",controller:"adminCtrl"}).when("/private",{templateUrl:"views/private.html",controller:"privCtrl"}).when("/public",{templateUrl:"views/public.html",controller:"publicCtrl"}).otherwise({redirectTo:"/login"})}),app.run(["$rootScope","loadServices","$http",function(a,b,c){a.tickers={Allan:[{headline:"",copy:"",created_str:""}],Fiona:[{headline:"",copy:"",created_str:""}]},b.getBios(),b.getTickers(),b.getProjects(),b.getCopy()}]),app.filter("capInitial",function(){return function(a){var b,c=[];return Array.isArray(a)?(c=a,b=c.forEach(capitalize)):("-"!=a.charAt(3)&&(a=a.toLowerCase()),c=a.split(","),c.forEach(elemIsArray)),b=c.join(",")}}),app.filter("mapTabs",function(){return function(a){var b=a,c={indholdsbaseret:"content","tidsafgrÃ¦nset":"point-in-time"};for(var d in c)d==a&&(b=c[d]);return b}}),app.filter("dotFilter",function(){return function(a){var b=a.replace(/,/g,/&sdot;/);return b}}),app.controller("acctsCtrl",["accountServices","$scope","appServices","$http","$rootScope",function(a,b,c,d,e){b.getValues=function(){},b.addAcct=function(){a.addAcct(this.form,b),c.selectTab("list")},b.viewAcct=function(){a.viewAcct(this.form.acct_type,b)},b.delAcct=function(){a.deleteAcct(this.user,b)}}]),app.controller("AddTagsModalCtrl",["imageServices","capInitialFilter","$scope","$modalInstance","$http","$rootScope","appServices",function(a,b,c,d,e,f,g){c.submit=function(){c.activeTool="",this.img.id?this.tags_form.id=this.img.id:this.tags_form.id=this.uncategorized.id,a.addTags(c,this.tags_form),d.dismiss("cancel")},c.cancel=function(){f.img={},f.tags_form={},d.dismiss("cancel")}}]),app.controller("adminCtrl",["$scope","$rootScope","$location","appServices",function(a,b,c,d){var e=document.getElementsByClassName("collapse");a.batchEdit={},a.caption=b.copy.head.summary.images,a.template={},a.template.url="./views/images.html",a.templates={accounts:"./views/accounts.html",images:"./views/images.html",landing_page:"./views/landing-page.html"},a["switch"]=function(c){a.caption=b.copy.head.summary[c],a.template.url=a.templates[c],angular.element(e).collapse("hide")},a.select=function(a){d.selectTab(a.toLowerCase())}}]),app.controller("BatchEditModalCtrl",["imageServices","capInitialFilter","$scope","$modalInstance","$http","$rootScope","appServices",function(a,b,c,d,e,f,g){c.submit=function(){this.batchEdit&&(this.batchEdit.id=c.ids,a.batchEdit(this.batchEdit,c)),d.dismiss("cancel")},c["delete"]=function(){a.deleteImages(c.ids,c),d.dismiss("cancel")},c.cancel=function(){f.img={},d.dismiss("cancel")}}]),app.controller("globalNavCtrl",["$scope","$rootScope","appServices",function(a,b,c){a.goTo=function(a){b.view=a,b.template.url=b.copy.partials[a].url}}]),app.controller("imageCtrl",["storageServices","eventServices","imageServices","$scope","$rootScope","$http","Upload","$timeout","$location","$interval","appServices",function(a,b,c,d,e,f,g,h,i,j,k){function l(){c.getNewImages(d),c.getAll(d),b.getAllEvents(d),d.batchObj={},d.batch={}}l(),d.runReInit=function(){l()};document.getElementsByClassName("collapse");d.toolSelector=function(){d.activeTool=this.activeTool},d.runTool=function(){d[d.activeTool]()},d.checkExif=function(){function a(){for(var a=0;a<d.images.length&&"update"!==d.images[a].meta[d.images[a].meta.length-1].toLowerCase();)a++;return d.images[a]?a.toString():!1}var b=a();if(!b){var f=[];d.images.forEach(function(a,b){"checked"===a.meta[a.meta.length-1]&&f.push(a)})}b&&(e.transientImage=d.images[b],e.transientImage.meta.push("checked"),c.getExifData(d))},d.loadNewImages=function(){function a(){for(var a in d.newImages)if(d.newImages[a]===!0)return a}e.transientImage.file=a(),e.transientImage.storage=e.default_storage,e.transientImage.file&&c.getExifData(d)},d.deleteImg=function(){var a;a=this.uncategorized.id?this.uncategorized.id:this.img.id,c.deleteImages(a,d)},d.mngBatchObj=function(){if(d.batch.all)for(var a in e.uncategorized)d.batchObj[e.uncategorized[a].id]=!0;else d.batchObj={}},d.deleteStorage=function(){a.deleteStorage(this.storage.folder)},d.getEventById=function(){var a=this.tags_form.event.img_id;e.img={},b.getEventById(a),c.getImgById(a)},d.updateEvent=function(){b.updateEvent(e.tags_form.event)},d.getImgById=function(){e.tags_form={},c.getImgById(this.img.id)}}]),app.controller("indexCtrl",["$location","$http","$rootScope","$scope","$global","getGlobals","appServices",function(a,b,c,d,e,f,g){switch(a.$$hash){case"about_allan":angular.element(document.getElementsByClassName("content-section-b allan")).css("border-bottom","0px"),angular.element(document.getElementsByClassName("fiona")).addClass("ng-hide");break;case"about_fiona":angular.element(document.getElementsByClassName("allan")).addClass("ng-hide");break;default:a.path("/login")}}]),app.controller("landingPageCtrl",["$scope","$http","$rootScope","appServices","landingPageServices",function(a,b,c,d,e){a.postItem=function(){null===this.form.date&&(this.form.date=new Date),this.form.date_str=this.form.date.toDateString(),e.postTicker(this.form),a.form={}},a.postProject=function(){c.load=void 0,e.postProject(this.form),a.form={}},a.getBio=function(){e.getBio(this.form.owner),a.form=c.subjects[this.form.owner]},a.addBio=function(){e.postBio(this.form),a.form={}}}]),app.controller("LatestEventModalCtrl",function(a,b,c){a.cancel=function(){b.dismiss("cancel")}}),app.controller("localNavCtrl",["$scope","appServices",function(a,b){a.goTo=function(a){b.selectTab(a.toLowerCase())}}]),app.controller("LoginModalCtrl",function(a,b,c,d,e,f,g,h,i){a.submit=function(){c.post("/login/authenticate",a.form).then(function(a){var b=a.data.acct_type,c=a.data.lang;"admin"===b?(f.getCopy(),e.img={},e.tags_form={},e.transientImage={},g.getStorages(),h.getUncategorisedImg(),e.default_storage=a.data.storages[0],d.path("/admin")):"private"===b?(f.getCopy(c),e.storages=a.data.storages,e.default_storage=e.storages[0],e.active_table="images",d.path("/private")):d.path("/login")}),b.dismiss("cancel")},a.cancel=function(){b.dismiss("cancel")}}),app.controller("logoutCtrl",function(a,b,c,d){a.logout=function(){d.getCopy(),c.get("/logout").then(function(a){b.path("/login")})}}),app.controller("ModalInstanceCtrl2",function(a,b,c,d,e){function f(c){var d;d=0==c?b.events.length:c,a.selected={event:b.events[c],eventPlusOne:b.events[c+1],eventMinusOne:b.events[d-1]}}a.selector=0,f(a.selector),a.cancel=function(){c.dismiss("cancel")},a.play=function(b){a.interval?(e.cancel(a.interval),a.interval=!1):a.interval=e(function(){a.next()},5e3)},a.next=function(){a.selected.event=a.selected.eventPlusOne,a.selector<b.events.length-1?a.selector++:a.selector=0,f(a.selector)},a.previous=function(){a.selected.event=a.selected.eventMinusOne,0==a.selector?a.selector=b.events.length-1:a.selector--,f(a.selector)}}),app.controller("ModifyAcctModalCtrl",function(a,b,c,d){d.getStorages(),a.submit=function(d){d?(this.user.option=d,c.put("/accounts_mgmt/modify_storage",this.user).then(function(b){a.viewAcct(b.config.data.acct_type)}),b.dismiss("cancel")):(this.user.new_password===a.user.confirm_password?c.put("/accounts_mgmt/chg",a.user).then(function(a){var b=document.getElementById("alerts");angular.element(b).html(a.data)}):angular.element(document.getElementById("alerts")).html("password mismatch"),b.dismiss("cancel"))},a.cancel=function(){b.dismiss("cancel")}}),app.controller("ModifyStorageModalCtrl",function(a,b,c,d,e,f){a.submit=function(a){"add"===a&&f.addStorage(this.storage),"modify"===a&&f.modifyStorage(this.storage),b.dismiss("cancel")},a.cancel=function(){b.dismiss("cancel")}}),app.controller("multiViewModalCtrl",function(a,b,c,d,e,f){a.animationsEnabled=!0,a.submitCriteria=function(c,g){a.spinning=!0,a.executeSearch(g),e(function(){var e=f.setModal("multi");if(b.events.length>0){d.open({animation:a.animationsEnabled,templateUrl:e.templ,controller:e.contr,size:c,resolve:{events:function(){return b.events}}})}a.spinning=!1},2500)},a.executeSearch=function(d){var e={},g=[];f.getConditions()&&(g=f.getConditions().trim().split(" ")),"meta"===d&&g[0]?"select"!==g[0].toLowerCase()?e.query="select id, created, year, month, day, path || folder || '/' || file as url from (select * from images where meta is not null "+f.getConditions()+") as x cross join storages where folder = x.storage order by created asc":(e.query="select id, created, year, month, day, path || folder || '/' || file as url from ("+f.getConditions()+") as x cross join storages where folder = x.storage order by created asc",e.query=e.query.replace(/COLUMN/g,"*")):(Object.keys(a.searchArea).forEach(function(b,c,d){a.searchArea[b]&&(a.form.table=b)}),e=a.form);c.post("/queries",e).then(function(a){b.events=a.data}),"meta"==d?a.clear():a.select("time")}}),app.controller("privCtrl",["mapTabsFilter","$scope","$rootScope","$http","$log","$modal","$location","appServices","imageServices","eventServices",function(a,b,c,d,e,f,g,h,i,j){b.summaryCount={},i.getDbCount(b),j.getEventCount(b),j.getLatestEvent(b),i.getVideos(b),h.resetSQ(),h.initPiTSearch(b,"images"),c.template={},c.view="images",c.template.url="./views/imageSearch.html",b.selected_db=c.default_storage;var k=document.getElementsByClassName("collapse");angular.element(k).collapse("hide"),b.select=function(c){c=a(c.toLowerCase()),h.selectTab(c),"meta"===c?(b.form={},b.form.contract=!0,h.buildMeta()):(b.form={},h.initPiTSearch(b,"images"))},b.selectTable=function(a){angular.element(k).collapse("hide"),"videos"==a&&(angular.element(document.getElementById("nav_videos")).addClass("ng-hide"),angular.element(document.getElementById("nav_images")).removeClass("ng-hide")),"images"==a&&(angular.element(document.getElementById("nav_images")).addClass("ng-hide"),angular.element(document.getElementById("nav_videos")).removeClass("ng-hide")),c.active_table=a,h.initPiTSearch(b,a)},b.flipType=function(a){switch(typeof a){case"number":switch(a){case 0:b.form.expand=!1,b.form.exclude=!1;break;case 1:b.form.contract=!1,b.form.exclude=!1;break;case 2:b.form.contract=!1,b.form.expand=!1}break;case"string":switch(a){case"images":b.searchArea.events=!1;break;case"events":b.searchArea.images=!1}}},b.build_query=function(a){var b={};this.form[a]&&(0===Object.keys(c.baseline).length?(c.baseline[a]=this.form[a],this.form.exclude&&(c.baseline_type="exclude")):(this.form.contract&&this.form[a]&&(b.contract={},b.contract[a]=this.form[a]),this.form.expand&&this.form[a]&&(b.expand={},b.expand[a]=this.form[a]),this.form.exclude&&this.form[a]&&(b.exclude={},b.exclude[a]=this.form[a])),b.baseline=c.baseline,!c.search_terms.contract[a]&&this.form.contract||!c.search_terms.expand[a]&&this.form.expand||!c.search_terms.exclude[a]&&this.form.exclude?(this.form.contract&&this.form[a]&&(c.search_terms.contract[a]=[],c.search_terms.contract[a].push(this.form[a])),this.form.expand&&this.form[a]&&(c.search_terms.expand[a]=[],c.search_terms.expand[a].push(this.form[a])),this.form.exclude&&this.form[a]&&(c.search_terms.exclude[a]=[],c.search_terms.exclude[a].push(this.form[a]))):(this.form.contract&&this.form[a]&&c.search_terms.contract[a].push(this.form[a]),this.form.expand&&this.form[a]&&c.search_terms.expand[a].push(this.form[a]),this.form.exclude&&this.form[a]&&c.search_terms.exclude[a].push(this.form[a])),h.buildMeta(b))},b.getValues=function(a){var c="";if(this.form.year){switch(a){case"year":this.form.option="month";break;case"month":this.form.option="day";break;case"day":this.form.option="year"}Object.keys(b.searchArea).forEach(function(a,d,e){b.searchArea[a]&&(c=a)}),this.form.table=c,h.buildDropdowns(b)}},b.clear=function(){this.form.table?(b.form={},h.initPiTSearch(b,"images")):(b.form={},b.form.contract=!0,b.form.expand=!1,b.form.exclude=!1,h.resetSQ(),h.buildMeta())},b.expand=function(a){b.videos.active=this.item.year},b.collapse=function(a){b.videos.active=!1}}]),app.controller("ResumeModalCtrl",function(a,b,c,d,e){a.cancel=function(){b.dismiss("cancel")}}),app.controller("SaveImgModalCtrl",["imageServices","$scope","$rootScope","$modalInstance","$http","Upload","$timeout",function(a,b,c,d,e,f,g){b.uploadFiles=function(e,h){var i=document.getElementById("progress"),j=0;c.transientImage.storage=c.default_storage,c.transientImage.file=e.name,b.created&&(c.transientImage.created=b.created),b.activeTool="",c.f=e,e&&!e.$error&&h&&(e.upload=f.upload({url:"/images_mgmt/upload/"+c.default_storage,data:{file:e},method:"PUT"}),e.upload.then(function(a){g(function(){e.result=a.data})},function(a){a.status>0&&(b.errorMsg=a.status+": "+a.data)}),e.upload.progress(function(f){e.progress=Math.min(100,parseInt(100*f.loaded/f.total));var g=e.progress+"%";angular.element(i).css({width:g}),100==e.progress&&(j++,3===j&&(a.getExifData(b),d.dismiss("cancel"),c.f=void 0))}))}}]),app.controller("singleViewModalCtrl",function(a,b,c,d,e,f,g,h){var i=document.getElementsByClassName("collapse");a.animationsEnabled=!0,a.open=function(e,f,h){var j={$scope:a,$modal:c,modal:g.setModal(f),size:e};if(f=f?f.toLowerCase():f,h=h?h.toLowerCase():h,"batch"===f){var k=[];for(var l in a.batchObj)a.batchObj[l]&&(k.push(l),a.batchObj[l]=!1);k.length>=1&&(a.ids=k,openModal(j))}else"event"===f?b.get("/queries/latest").then(function(a){a.data.hasOwnProperty("id")&&(j.$scope.event=a.data,angular.element(i).collapse("hide"),openModal(j))}):"new"===h?(this.uncategorized&&(d.tags_form.image={},d.tags_form.image.country=this.uncategorized.country,d.tags_form.image.state=this.uncategorized.state,d.tags_form.image.city=this.uncategorized.city,d.tags_form.image.id=this.uncategorized.id),a.img.url=this.uncategorized.url,openModal(j)):"allan"===h?(a.projects=d.resumes.Allan,openModal(j)):"fiona"===h?(a.projects=d.resumes.Fiona,openModal(j)):openModal(j)}}),app.controller("VideoModalCtrl",function(a,b,c,d,e){a.cancel=function(){b.dismiss("cancel")}}),app.service("accountServices",["$http",function(a){var b={};return b.addAcct=function(c,d){a.post("/accounts_mgmt/add",c).then(function(a){b.viewAcct(c.acct_type,d)})},b.deleteAcct=function(c,d){a["delete"]("/accounts_mgmt/"+c.username).then(function(a){b.viewAcct(c.acct_type,d)})},b.viewAcct=function(b,c){a.get("/accounts_mgmt/"+b).then(function(a){c.users=a.data})},b}]),app.service("eventServices",["$http","$rootScope",function(a,b){var c={};return c.postEvent=function(c,d){a.post("/events_mgmt/add",d).then(function(a){b.tags_form={},b.img={}}).then(function(){c.runReInit()})},c.getEventById=function(c){a.get("/events_mgmt/get_one/"+c).then(function(a){a.data.length>0&&(b.tags_form.event=a.data[0],b.img.id=c)})},c.updateEvent=function(c){var d={};for(var e in c)"url"!==e&&(d[e]=c[e]);a.put("/events_mgmt",d).then(function(a){b.tags_form.event={},b.img={}})},c.getLatestEvent=function(b){a.get("/queries/latest").then(function(a){b.event=a.data})},c.getAllEvents=function(b){a.get("/events_mgmt").then(function(a){b.events=a.data})},c.getEventCount=function(c){a.get("/events_mgmt/get_count/"+b.default_storage).then(function(a){c.summaryCount.events=a.data})},c}]),app.factory("appServices",["$http","$rootScope",function(a,b){var c,d,e={},f={meta:"meta_div",time:"time_div",list:"list_div",add:"add_div",images:"image_div",events:"event_div",storages:"storage_div",projects:"resume_div",tickers:"ticker_div",biographies:"biography_div"},g={login:{contr:"LoginModalCtrl",templ:"./views/myLoginModal.html"},modify:{contr:"ModifyAcctModalCtrl",templ:"./views/myChangePWModal.html"},resume:{contr:"ResumeModalCtrl",templ:"./views/myResumeModal.html"},file:{contr:"SaveImgModalCtrl",templ:"./views/mySaveImgModal.html"},meta:{contr:"AddTagsModalCtrl",templ:"./views/myAddTagsModal.html"},storage:{contr:"ModifyAcctModalCtrl",templ:"./views/myManageStoragesModal.html"},modify_storage:{contr:"ModifyStorageModalCtrl",templ:"./views/myModifyStorageModal.html"},add_storage:{contr:"ModifyStorageModalCtrl",templ:"./views/myAddStorageModal.html"},event:{contr:"LatestEventModalCtrl",templ:"./views/myLatestEventModal.html"},multi:{contr:"ModalInstanceCtrl2",templ:"./views/myMultiViewModal.html"},batch:{contr:"BatchEditModalCtrl",templ:"./views/myBatchEditModal.html"},video:{contr:"VideoModalCtrl",templ:"./views/myVideoModal.html"}};return e.setModal=function(a){return g[a]},e.buildMeta=function(e){var f,g,h,i=Object.keys(b.baseline).toString();for(var j in e)"baseline"!==j&&(f=Object.keys(e[j]).toString(),g=j,h=e[j]);switch(g){case"contract":d+="names"!==f&&"meta"!==f?" AND "+Object.keys(h).toString()+" = xxx"+h[Object.keys(h).toString()]+"xxx":" AND xxx"+h[Object.keys(h).toString()]+"xxx = ANY("+Object.keys(h).toString()+")";break;case"expand":d+="names"!==f&&"meta"!==f?" OR "+Object.keys(h).toString()+" = xxx"+h[Object.keys(h).toString()]+"xxx":" OR xxx"+h[Object.keys(h).toString()]+"xxx = ANY("+Object.keys(h).toString()+")";break;case"exclude":"names"!==f&&"meta"!==f&&1>c?(d="SELECT DISTINCT RES"+c+".COLUMN FROM (SELECT * FROM IMAGES WHERE META IS NOT NULL "+d+") AS RES"+c+" WHERE "+f+" != xxx"+h[f]+"xxx",c++,b.exlc_incr++):(d=d.replace(/RES\w.COLUMN/g,"ASTERIX"),d="SELECT DISTINCT RES"+c+".* FROM ("+d+") as RES"+c+" where "+f+" != xxx"+h[f]+"xxx",c++);break;case void 0:"exclude"===b.baseline_type?d=" AND "+i+" != xxx"+b.baseline[i]+"xxx":"names"===i||"meta"===i?d=" AND xxx"+b.baseline[i]+"xxx = ANY("+i+")":i&&(d=" AND "+i+" = xxx"+b.baseline[i]+"xxx")}d?a.get("/dropdowns/"+d).then(function(a){b.meta=a.data}):a.get("/dropdowns/").then(function(a){b.meta=a.data}),a.put("/queries/count",{conditions:d}).then(function(a){b.queries_count=a.data[0].count})},e.selectTab=function(a){for(var b in f)b!==a?(angular.element(document.getElementById(b)).removeClass("active"),angular.element(document.getElementById(f[b])).addClass("ng-hide")):(angular.element(document.getElementById(b)).addClass("active"),angular.element(document.getElementById(f[b])).removeClass("ng-hide"))},e.resetSQ=function(){b.baseline={},b.baseline_type="",b.queries_count="",b.search_terms={},b.search_terms.contract={},b.search_terms.expand={},b.search_terms.exclude={},d=void 0,c=0,b.exlc_incr=0},e.getConditions=function(){return d},e.buildDropdowns=function(b){a.post("/dropdowns/build",b.form).then(function(a){b.list.push(a.data)})},e.initPiTSearch=function(a,b){a.list=[],a.form={},a.form.option="year",a.form.table=b,a.searchArea={},a.searchArea[b]=!0,e.buildDropdowns(a)},e.getCopy=function(c){a.get("./models/copy.json").then(function(a){c?b.copy=a.data.views["private"][c]:b.copy=a.data.views.admin})},e}]),app.factory("getGlobals",["$global",function(a){var b=a.request;return{tickers:function(){return b(a.url("tickers"))},biographies:function(){return b(a.url("biographies"))},resumes:function(){return b(a.url("resumes"))}}}]),app.service("imageServices",["$http","$rootScope","appServices","capInitialFilter","eventServices",function(a,b,c,d,e){var f={};return f.getAll=function(b){a.get("/images_mgmt/get_all").then(function(a){b.images=a.data})},f.getLatest=function(){a.get("/images_mgmt/get_latest").then(function(a){b.img=a.data})},f.addImg=function(c){a.post("/images_mgmt/add",b.transientImage).then(function(a){"error"==a.data.name?c.newImages[b.transientImage.file]=a.data.detail:c.newImages[b.transientImage.file]=!1}).then(function(a){b.transientImage={},f.getUncategorisedImg(),"loadNewImages"===c.activeTool&&c.loadNewImages()})},f.addTags=function(a,b){if(b.event&&b.add_event&&(b.event.img_id=b.id,e.postEvent(a,b.event)),b.image&&b.add_tags){b.image.id=b.id;for(var c in b.image)b.image[c]&&"number"!=typeof b.image[c]&&(b.image[c]=d(b.image[c]));f.addMeta(a,b.image)}},f.addMeta=function(c,d){d=d?d:b.transientImage,a.put("/images_mgmt/add_meta",d).then(function(a){f.getUncategorisedImg(),b.transientImage={},b.tags_form={},b.img={}}).then(function(a){c.runReInit()}).then(function(a){"checkExif"===c.activeTool&&c.checkExif()})},f.getUncategorisedImg=function(c){a.get("/images_mgmt/get_new").then(function(a){b.uncategorized=a.data})},f.getImgById=function(c){a.get("/images_mgmt/get_one/"+c).then(function(a){b.img=a.data,b.tags_form.image={};for(var d in b.img)"number"!=typeof b.img[d]&&"created"!=d&&"url"!=d&&"file"!=d&&"storage"!=d&&(b.tags_form.image[d]=b.img[d]);b.img.event||e.getEventById(c)})},f.batchEdit=function(b,c){var e={};b.country&&"usa"===b.country.toLowerCase()&&(e.country="United States");for(var g in b)b[g]&&g&&(e[g]=d(b[g]));a.post("/images_mgmt/batch",e).then(function(a){f.getUncategorisedImg(),c.runReInit()})},f.getNewImages=function(b){b.newImages={},a.get("/image_jobs/files").then(function(a){a.data&&(b.newImages=a.data)})},f.deleteImages=function(c,d){a["delete"]("/images_mgmt/"+c).then(function(a){f.getUncategorisedImg(),b.img={},d.runReInit()})},f.getDbCount=function(c){a.get("/image_jobs/count/"+b.default_storage).then(function(a){c.summaryCount.images=a.data.size})},f.getExifData=function(c){a.post("/exif/",b.transientImage).then(function(a){for(var d in a.data)b.transientImage[d]=a.data[d];switch(c.activeTool){case"checkExif":b.transientImage.meta.push("updated"),f.addMeta(c);break;default:f.addImg(c)}})},f.getVideos=function(b){a.get("/videos_mgmt/videos").then(function(a){function c(a,b){e[b].push("./buffalo/videos/"+a),e.length++}var d=[],e={};e.length=0,a.data.forEach(function(a,b,d){var f=a.split("_")[1].slice(0,4);e[f]?c(a,f):(e[f]=[],c(a,f))});for(var f in e){var g=[];if("length"!=f){e[f].forEach(function(a,b,c){g[Math.floor(b/5)]||(g[Math.floor(b/5)]=[]),g[Math.floor(b/5)].push(a)});var h={year:f,videos:g};d.unshift(h)}}d.quantity=e.length,b.videos=d,b.summaryCount.videos=d.quantity})},f}]),app.service("landingPageServices",["$http","loadServices",function(a,b){this.postTicker=function(c){a.post("/landing_mgmt/tickers",c).then(function(a){b.getTickers()})},this.postProject=function(c){a.post("/landing_mgmt/projects",c).then(function(a){b.getProjects()})},this.postBio=function(c){a.put("/landing_mgmt/bios",c).then(function(a){b.getBios()})},this.getBio=function(a){b.getBios()}}]),app.service("loadServices",["$http","$rootScope",function(a,b){this.getBios=function(){a.get("landing_mgmt/bios/all").then(function(a){b.subjects=a.data})},this.getTickers=function(){a.get("/landing_mgmt/tickers").then(function(a){b.tickers=a.data})},this.getProjects=function(){a.get("/landing_mgmt/projects").then(function(a){b.resumes=a.data})},this.getCopy=function(){a.get("./models/copy.json").then(function(a){b.copy=a.data.views["public"]})}}]),app.factory("$global",["$http",function(a){var b={biographies:"/landing_mgmt/bios/all",tickers:"/landing_mgmt/tickers",resumes:"/landing_mgmt/projects"},c={},d={},e={},f={};return f.request=function(b){return a.get(b)},f.url=function(a){return b[a]},f.setBiographies=function(a){c=a},f.getBiographies=function(){return c},f.setTickers=function(a){d=a},f.getTickers=function(){return d},f.setResumes=function(a){e=a},f.getResumes=function(){return e},f}]),app.service("storageServices",["$http","$rootScope",function(a,b){var c={};return c.addStorage=function(b){a.post("/storages_mgmt/add",b).then(function(a){c.getStorages()})},c.deleteStorage=function(b){a["delete"]("/storages_mgmt/"+b).then(function(a){c.getStorages()})},c.getStorages=function(){a.get("/storages_mgmt/all").then(function(a){b.storages=a.data})},c.modifyStorage=function(b){a.put("/storages_mgmt/update",b).then(function(a){c.getStorages()})},c}]),app.service("FUCK",["$http","$rootScope","$scope",function(a,b,c){var d={};return d.getAll=function(a){},d}]),app.directive("insertBio",function(){return{restrict:"E",scope:{thisSubject:"=info"},templateUrl:"views/biography.html"}}),app.directive("myASection",function(){return{restrict:"EA",scope:{subject:"=info"},templateUrl:"views/myASection.html"}}),app.directive("myAddStorageModal",function(){return{restrict:"EA"}}),app.directive("myAddTagsModal",function(){return{restrict:"EA",scope:{copy:"=info"}}}),app.directive("myBSection",function(){return{restrict:"E",templateUrl:"views/myBSection.html"}}),app.directive("myBatchEditModal",function(){return{restrict:"EA"}}),app.directive("myChangePwModal",function(){return{restrict:"EA"}}),app.directive("myGlobalNav",function(){return{restrict:"E",scope:{globalTabs:"=info"},templateUrl:"./views/myGlobalNavMenu.html"}}),app.directive("myLatestEventModal",function(){return{restrict:"EA",templateUrl:"views/myLatestEventModal.html"}}),app.directive("myLocalNav",function(){return{restrict:"E",scope:{localTabs:"=info"},templateUrl:"./views/myLocalNavMenu.html"}}),app.directive("myLoginModal",function(){return{restrict:"EA"}}),app.directive("myManageStoragesModal",function(){return{restrict:"EA"}}),app.directive("myModifyStorageModal",function(){return{restrict:"EA"}}),app.directive("myMultiViewModal",function(){return{restrict:"EA",templateUrl:"views/multiView.html"}}),app.directive("myResumeModal",function(){return{restrict:"EA"}}),app.directive("mySaveImgModal",function(){return{restrict:"EA"}}),app.directive("myVideoModal",function(){return{restrict:"EA",templateUrl:"views/myVideoModal.html"}});