function elemIsArray(a,b,c){var d;if(a=a.trim(),Array.isArray(a.split(" "))&&a.split(" ").length>1){var e=a.split(" ");e.forEach(capitalize),c[b]=e.join(" ")}else a=capitalize(a),c[b]=a.toString();return d=c.join(",")}function capitalize(a,b,c){a=a.trim();var d;d=c?c:void 0;var e=[],f="";if("of"!==a&&"the"!==a||0==b){for(var g=0;g<=a.length;g++)e.push(a[g]);f=e[0].toUpperCase(),e.shift(),e.unshift(f),a=e.join("")}else;return c?c[b]=a:(c=[],c.push(a)),c}function openModal(a){if("ModalInstanceCtrl"!==a.modal.contr||a.$scope.event){a.$modal.open({scope:a.$scope,animation:a.$scope.animationsEnabled,templateUrl:a.modal.templ,controller:a.modal.contr,size:a.size})}else;}var app=angular.module("myApp",["ngRoute","ui.bootstrap","ngAnimate","ngFileUpload","simpleAngularTicker"]);app.config(function(a,b){b.html5Mode(!0),a.when("/login",{templateUrl:"views/login.html",controller:"singleViewModalCtrl"}).when("/admin/btle",{templateUrl:"views/btle.html",controller:"locationCtrl"}).when("/admin/diary",{templateUrl:"views/diary.html",controller:"locationCtrl"}).when("/priv_uk",{templateUrl:"views/priv_en.html",controller:"privCtrl"}).when("/priv_dk",{templateUrl:"views/priv_da.html",controller:"privCtrl"}).when("/public",{templateUrl:"views/public.html",controller:"publicCtrl"}).otherwise({redirectTo:"/login"})}),app.run(["loadServices","$rootScope",function(a,b){b.tickers={Allan:[{headline:"",copy:"",created_str:""}],Fiona:[{headline:"",copy:"",created_str:""}]},a.getBios(),a.getTickers(),a.getProjects()}]),app.filter("capInitial",function(){return function(a){var b,c=[];return Array.isArray(a)?(c=a,b=c.forEach(capitalize)):(a=a.toLowerCase(),c=a.split(","),c.forEach(elemIsArray)),b=c.join(",")}}),app.filter("mapTabs",function(){return function(a){var b=a,c={indholdsbaseret:"content","tidsafgrÃ¦nset":"point-in-time"};for(var d in c)d==a&&(b=c[d]);return b}}),app.filter("dotFilter",function(){return function(a){var b=a.replace(/,/g,/&sdot;/);return b}}),app.controller("acctsCtrl",["accountServices","$scope","appServices","$http",function(a,b,c,d){b.acct=[{name:"<<acct_type>>",value:null},{name:"Private",value:"private"},{name:"Public",value:"public"},{name:"Admin",value:"admin"},{name:"Superuser",value:"superuser"}],b.lang=[{name:"<<language>>",value:null},{name:"English",value:"en"},{name:"Danish",value:"da"}],b.getValues=function(){},b.addAcct=function(){a.addAcct(this.form),c.selectTab("list")},b.viewAcct=function(){a.viewAcct(this.form.acct_type,b)},b.delAcct=function(){a.deleteAcct(this.user)}}]),app.controller("AddTagsModalCtrl",["imageServices","capInitialFilter","$scope","$modalInstance","$http","$rootScope","appServices",function(a,b,c,d,e,f,g){c.submit=function(){if(c.batchObj.hasOwnProperty(this.img.id)){c.batchObj[this.img.id]=!1;var b=0;for(var e in c.batchObj)c.batchObj[e]&&b++;0==b&&(c.batch.all=!1)}a.addTags(this.img),d.dismiss("cancel")},c.cancel=function(){f.img={},d.dismiss("cancel")}}]),app.controller("BatchEditModalCtrl",["imageServices","capInitialFilter","$scope","$modalInstance","$http","$rootScope","appServices",function(a,b,c,d,e,f,g){c.submit=function(){this.batchEdit&&(this.batchEdit.id=c.ids,a.batchEdit(this.batchEdit)),d.dismiss("cancel")},c["delete"]=function(){a.deleteImages(c.ids),d.dismiss("cancel")},c.cancel=function(){f.img={},d.dismiss("cancel")}}]),app.controller("imageCtrl",["storageServices","eventServices","imageServices","$scope","$rootScope","$http","Upload","$timeout","$location","$interval","appServices",function(a,b,c,d,e,f,g,h,i,j,k){function l(){for(var a in e.newImages)if(e.newImages[a]===!0)return a}k.update_files(),c.getNewFiles(),c.getUncategorisedImg(),c.getAll(),b.getAllEvents(),d.tools=[{name:"import",value:"loadNewImages"},{name:"update",value:"checkExif"}],d.activeTool=d.tools[0].value,d.toolSelector=function(a){d.activeTool=a},d.runTool=function(){e[d.activeTool]()},e.checkExif=function(){function a(){for(var a=0;a<e.images.length&&("checked"==e.images[a].meta[e.images[a].meta.length-1].toLowerCase()||"updated"==e.images[a].meta[e.images[a].meta.length-1].toLowerCase());)a++;return e.images[a]?a.toString():!1}var b=a();if(!b){var g=[];e.images.forEach(function(a,b){"checked"===a.meta[a.meta.length-1]&&g.push(a)})}b&&f.get("/exif/"+e.images[b].file).then(function(a){if(a.data.created){var g=a.data.coordinates;for(var h in e.images[b])"id"!=h&&"meta"!=h&&(e.images[b][h]=!1);e.images[b].created=a.data.created,f.get("https://maps.googleapis.com/maps/api/geocode/json?latlng="+a.data.coordinates+"&key="+a.data.API_KEY).then(function(a){"OK"===a.data.status&&(e.images[b]=c.buildImageObject(e.images[b],a.data.results[0].address_components)),g&&"ZERO_RESULTS"===a.data.status&&(e.images[b].country="En Route",e.images[b].state="N/a",e.images[b].city="En Route"),e.images[b].meta.push("updated"),f.put("/images_mgmt/add_meta",e.images[b]).then(function(a){d.checkExif()})})}else e.images[b].meta.push("checked"),d.checkExif()})},e.loadNewImages=function(){var a={};a.file=l(),a.storage=e.default_storage,a.file&&c.addImg(a,!0)},d.batchObj={},d.batch={},d.deleteImg=function(){d.batchObj.hasOwnProperty(this.uncategorized.id)&&(d.batchObj[this.uncategorized.id]=!1,1==Object.keys(d.batchObj).length&&(d.batch.all=!1)),c.deleteImages(this.uncategorized.id)},d.mngBatchObj=function(){if(d.batch.all)for(var a in e.uncategorized)d.batchObj[e.uncategorized[a].id]=!0;else d.batchObj={}};document.getElementsByClassName("collapse");e.img={},e.event_form={},d.deleteStorage=function(){a.deleteStorage(this.storage.folder)},d.addEvent=function(){e.event_form.img_id=e.img.id,e.event_form.updated=new Date,b.postEvent(e.event_form),e.event_form={},e.f={}},d.getEventById=function(a,f){e.event_form={},f?d.select("event"):c.getImgById(a),b.getEventById(a)},d.updateEvent=function(){b.updateEvent(e.event_form)},d.getImgById=function(a){c.getImgById(a)}}]),app.controller("indexCtrl",["$location","$http","$rootScope","$scope","$global","getGlobals",function(a,b,c,d,e,f){switch(a.$$hash){case"about_allan":angular.element(document.getElementsByClassName("content-section-b allan")).css("border-bottom","0px"),angular.element(document.getElementsByClassName("fiona")).addClass("ng-hide");break;case"about_fiona":angular.element(document.getElementsByClassName("allan")).addClass("ng-hide");break;default:a.path("/login")}}]),app.controller("landingPageCtrl",["$scope","$http","$rootScope","appServices","landingPageServices",function(a,b,c,d,e){a.postItem=function(){null===this.form.date&&(this.form.date=new Date),this.form.date_str=this.form.date.toDateString(),e.postTicker(this.form),a.form={}},a.postProject=function(){c.load=void 0,e.postProject(this.form),a.form={}},a.getBio=function(){e.getBio(this.form.owner),a.form=c.subjects[this.form.owner]},a.addBio=function(){e.postBio(this.form),a.form={}},a.owners=[{name:"Allan",value:"Allan"},{name:"Fiona",value:"Fiona"}]}]),app.controller("locationCtrl",["$scope","$rootScope","$location","appServices",function(a,b,c,d){var e=document.getElementsByClassName("collapse");b.captions={images:"Images",accounts:"Accounts",landing_page:"Landing Page"},b.caption=b.captions.images,b.template={},b.template.url="./views/images.html",a.templates={accounts:"./views/accounts.html",images:"./views/images.html",landing_page:"./views/landing-page.html"},a["switch"]=function(c){b.caption=b.captions[c],b.template.url=a.templates[c],angular.element(e).collapse("hide")},a.setLocation=function(a){"btle"===a&&(c.path("/admin/btle"),b.template={}),"diary"===a&&c.path("/admin/diary")},a.select=function(a){d.selectTab(a.toLowerCase())}}]),app.controller("LoginModalCtrl",function(a,b,c,d,e,f,g){e.new_files={},a.submit=function(){c.post("/login/authenticate",a.form).then(function(a){"admin"===a.data.acct_type?(g.getStorages(),e.default_storage=a.data.storages[0],d.path("/admin/diary")):"private"===a.data.acct_type&&"en"===a.data.lang?(e.storages=a.data.storages,e.default_storage=e.storages[0],d.path("/priv_uk")):"private"===a.data.acct_type&&"da"===a.data.lang?(e.storages=a.data.storages,e.default_storage=e.storages[0],d.path("/priv_dk")):"public"===a.data.acct_type?d.path("/public"):d.path("/login")}),b.dismiss("cancel")},a.cancel=function(){b.dismiss("cancel")}}),app.controller("logoutCtrl",function(a,b,c){a.logout=function(){c.get("/logout").then(function(a){b.path("/login")})}}),app.controller("ModalInstanceCtrl2",function(a,b,c,d,e){a.selector=0,a.events=d,a.selected={event:a.events[a.selector]},a.cancel=function(){c.dismiss("cancel")},a.play=function(b){a.interval?(e.cancel(a.interval),a.interval=!1):a.interval=e(function(){a.next()},5e3)},a.next=function(){a.selector<d.length-1?a.selector++:a.selector=0,a.selected={event:a.events[a.selector]}},a.previous=function(){0===a.selector?a.selector=d.length-1:a.selector--,a.selected={event:a.events[a.selector]}}}),app.controller("ModalInstanceCtrl",function(a,b,c){a.cancel=function(){b.dismiss("cancel")}}),app.controller("ModifyAcctModalCtrl",function(a,b,c,d){d.getStorages(),a.submit=function(d){d?(this.user.option=d,c.put("/accounts_mgmt/modify_storage",this.user).then(function(b){a.viewAcct(b.config.data.acct_type)}),b.dismiss("cancel")):(this.user.new_password===a.user.confirm_password?c.put("/accounts_mgmt/chg",a.user).then(function(a){var b=document.getElementById("alerts");angular.element(b).html(a.data)}):angular.element(document.getElementById("alerts")).html("password mismatch"),b.dismiss("cancel"))},a.cancel=function(){b.dismiss("cancel")}}),app.controller("ModifyStorageModalCtrl",function(a,b,c,d,e,f){a.submit=function(a){"add"===a&&f.addStorage(this.storage),"modify"===a&&f.modifyStorage(this.storage),b.dismiss("cancel")},a.cancel=function(){b.dismiss("cancel")}}),app.controller("multiViewModalCtrl",function(a,b,c,d,e){a.animationsEnabled=!0,a.open2=function(f,g){var h=e.setModal("multi"),i={},j=[];e.getConditions()&&(j=e.getConditions().trim().split(" ")),"meta"===g&&j[0]?"select"!==j[0].toLowerCase()?i.query="select id, created, path || folder || '/' || file as url from (select * from images where meta is not null "+e.getConditions()+") as x cross join storages where folder = x.storage order by created asc":(i.query="select id, created, path || folder || '/' || file as url from ("+e.getConditions()+") as x cross join storages where folder = x.storage order by created asc",i.query=i.query.replace(/COLUMN/g,"*")):(a.form.table=b.active_table,i=a.form);c.post("/queries",i).then(function(a){b.events=a.data}).then(function(){if(b.events.length>0){d.open({animation:a.animationsEnabled,templateUrl:h.templ,controller:h.contr,size:f,resolve:{events:function(){return b.events}}})}}),a.clear()}}),app.controller("privCtrl",["mapTabsFilter","$scope","$rootScope","$http","$log","$modal","$location","appServices","imageServices",function(a,b,c,d,e,f,g,h,i){function j(){b.form={},b.query={},b.query.option="year",b.query.table="images",d.post("/dropdowns/build",b.query).then(function(a){b.years=a.data})}function k(a){d.get("/image_jobs/count/"+a).then(function(a){c.img_db=a.data})}i.getLatestEvent(),j(),c.active_table="images",h.resetSQ(),b.selected_db=c.default_storage,k(b.selected_db),b.setActive=function(){k(b.selected_db)},b.years={},b.days={},b.months={};var l=document.getElementsByClassName("collapse");angular.element(l).collapse("hide"),b.select=function(c){c=a(c.toLowerCase()),h.selectTab(c),"event"===c&&d.get("/images_mgmt/get_all").then(function(a){b.images=a.data}),"content"===c&&(b.form.type_and=!0,h.buildMeta())},b.selectTable=function(a){angular.element(l).collapse("hide"),"events"==a&&(angular.element(document.getElementById("nav_events")).addClass("ng-hide"),angular.element(document.getElementById("nav_images")).removeClass("ng-hide")),"images"==a&&(angular.element(document.getElementById("nav_images")).addClass("ng-hide"),angular.element(document.getElementById("nav_events")).removeClass("ng-hide")),c.active_table=a,b.form={},b.query={},b.query.option="year",b.query.table=a,d.post("/dropdowns/build",b.query).then(function(a){b.years=a.data})},b.build_query=function(a){var b={};this.form[a]&&(0===Object.keys(c.baseline).length?(c.baseline[a]=this.form[a],this.form.exclude&&(c.baseline_type="exclude")):(this.form.type_and&&this.form[a]&&(b.contract={},b.contract[a]=this.form[a]),this.form.type_or&&this.form[a]&&(b.expand={},b.expand[a]=this.form[a]),this.form.exclude&&this.form[a]&&(b.exclude={},b.exclude[a]=this.form[a])),b.baseline=c.baseline,!c.search_terms.contract[a]&&this.form.type_and||!c.search_terms.expand[a]&&this.form.type_or||!c.search_terms.exclude[a]&&this.form.exclude?(this.form.type_and&&this.form[a]&&(c.search_terms.contract[a]=[],c.search_terms.contract[a].push(this.form[a])),this.form.type_or&&this.form[a]&&(c.search_terms.expand[a]=[],c.search_terms.expand[a].push(this.form[a])),this.form.exclude&&this.form[a]&&(c.search_terms.exclude[a]=[],c.search_terms.exclude[a].push(this.form[a]))):(this.form.type_and&&this.form[a]&&c.search_terms.contract[a].push(this.form[a]),this.form.type_or&&this.form[a]&&c.search_terms.expand[a].push(this.form[a]),this.form.exclude&&this.form[a]&&c.search_terms.exclude[a].push(this.form[a])),h.buildMeta(b))},b.getValues=function(a,c){"month"===a&&(b.form.option=!1,b.form.day=!1,b.form.month=!1),b.query={},b.query=b.form,b.query.option=a,b.query.table=c,d.post("/dropdowns/build",b.query).then(function(a){a.data[0].name&&(b.months=a.data),a.data[0].day&&(b.days=a.data)})},b.clear=function(){b.form={},b.form.type_and=!0,b.form.type_or=!1,b.form.exclude=!1,h.resetSQ(),h.buildMeta()}}]),app.controller("ResumeModalCtrl",function(a,b,c,d,e){a.cancel=function(){b.dismiss("cancel")}}),app.controller("SaveImgModalCtrl",["imageServices","$scope","$rootScope","$modalInstance","$http","Upload","$timeout",function(a,b,c,d,e,f,g){b.uploadFiles=function(e,h){var i=document.getElementById("progress"),j=0;b.img={},b.img.storage=c.default_storage,b.img.file=e.name,b.img.meta=b.meta,b.created&&(b.img.created=b.created),c.f=e,e&&!e.$error&&h&&(e.upload=f.upload({url:"/images_mgmt/upload/"+c.default_storage,data:{file:e},method:"PUT"}),e.upload.then(function(a){g(function(){e.result=a.data})},function(a){a.status>0&&(b.errorMsg=a.status+": "+a.data)}),e.upload.progress(function(f){e.progress=Math.min(100,parseInt(100*f.loaded/f.total));var g=e.progress+"%";angular.element(i).css({width:g}),100==e.progress&&(j++,3===j&&(a.addImg(b.img),d.dismiss("cancel"),c.f=void 0))}))}}]),app.controller("singleViewModalCtrl",function(a,b,c,d,e,f,g,h){var i=document.getElementsByClassName("collapse");a.animationsEnabled=!0,a.open=function(b,e,f){var h={$scope:a,$modal:c,modal:g.setModal(e),size:b};if(e=e?e.toLowerCase():e,f=f?f.toLowerCase():f,"batch"===e){var j=[];for(var k in a.batchObj)a.batchObj[k]&&(j.push(k),a.batchObj[k]=!1);j.length>=1&&(a.ids=j,openModal(h))}else"event"===e?(angular.element(i).collapse("hide"),h.$scope=d,openModal(h)):"new"===f?(a.img=this.uncategorized,openModal(h)):"allan"===f?(a.projects=d.resumes.Allan,openModal(h)):"fiona"===f?(a.projects=d.resumes.Fiona,openModal(h)):openModal(h)}}),app.service("accountServices",["$http",function(a){var b={};return b.addAcct=function(c){a.post("/accounts_mgmt/add",c).then(function(a){b.viewAcct(c.acct_type)})},b.deleteAcct=function(c){a["delete"]("/accounts_mgmt/"+c.username).then(function(a){b.viewAcct(c.acct_type)})},b.viewAcct=function(b,c){a.get("/accounts_mgmt/"+b).then(function(a){c.users=a.data})},b}]),app.service("eventServices",["$http","$rootScope",function(a,b){var c={};return c.postEvent=function(c){a.post("/events_mgmt/add",c).then(function(a){b.img={}})},c.getEventById=function(c){a.get("/events_mgmt/get_one/"+c).then(function(a){b.event_form=a.data})},c.updateEvent=function(c){var d={};for(var e in c)"url"!==e&&(d[e]=c[e]);a.put("/events_mgmt",d).then(function(a){b.event_form={},b.img={}})},c.getAllEvents=function(){a.get("/events_mgmt").then(function(a){b.events=a.data})},c}]),app.factory("appServices",["$http","$rootScope",function(a,b){var c,d,e={},f={content:"meta_div","point-in-time":"time_div",list:"list_div",add:"add_div",images:"image_div",events:"event_div",storages:"storage_div",projects:"resume_div",tickers:"ticker_div",biographies:"biography_div"},g={login:{contr:"LoginModalCtrl",templ:"./views/myLoginModal.html"},modify:{contr:"ModifyAcctModalCtrl",templ:"./views/myChangePWModal.html"},resume:{contr:"ResumeModalCtrl",templ:"./views/myResumeModal.html"},file:{contr:"SaveImgModalCtrl",templ:"./views/mySaveImgModal.html"},meta:{contr:"AddTagsModalCtrl",templ:"./views/myAddTagsModal.html"},storage:{contr:"ModifyAcctModalCtrl",templ:"./views/myManageStoragesModal.html"},modify_storage:{contr:"ModifyStorageModalCtrl",templ:"./views/myModifyStorageModal.html"},add_storage:{contr:"ModifyStorageModalCtrl",templ:"./views/myAddStorageModal.html"},event:{contr:"ModalInstanceCtrl",templ:"./views/myLatestEventModal.html"},multi:{contr:"ModalInstanceCtrl2",templ:"./views/myMultiViewModal.html"},batch:{contr:"BatchEditModalCtrl",templ:"./views/myBatchEditModal.html"}};return e.setModal=function(a){return g[a]},e.buildMeta=function(e){var f,g,h,i=Object.keys(b.baseline).toString();for(var j in e)"baseline"!==j&&(f=Object.keys(e[j]).toString(),g=j,h=e[j]);switch(g){case"contract":d+="names"!==f&&"meta"!==f?" AND "+Object.keys(h).toString()+" = xxx"+h[Object.keys(h).toString()]+"xxx":" AND xxx"+h[Object.keys(h).toString()]+"xxx = ANY("+Object.keys(h).toString()+")";break;case"expand":d+="names"!==f&&"meta"!==f?" OR "+Object.keys(h).toString()+" = xxx"+h[Object.keys(h).toString()]+"xxx":" OR xxx"+h[Object.keys(h).toString()]+"xxx = ANY("+Object.keys(h).toString()+")";break;case"exclude":"names"!==f&&"meta"!==f&&1>c?(d="SELECT DISTINCT RES"+c+".COLUMN FROM (SELECT * FROM IMAGES WHERE META IS NOT NULL "+d+") AS RES"+c+" WHERE "+f+" != xxx"+h[f]+"xxx",c++,b.exlc_incr++):(d=d.replace(/RES\w.COLUMN/g,"ASTERIX"),d="SELECT DISTINCT RES"+c+".* FROM ("+d+") as RES"+c+" where "+f+" != xxx"+h[f]+"xxx",c++);break;case void 0:"exclude"===b.baseline_type?d=" AND "+i+" != xxx"+b.baseline[i]+"xxx":"names"===i||"meta"===i?d=" AND xxx"+b.baseline[i]+"xxx = ANY("+i+")":i&&(d=" AND "+i+" = xxx"+b.baseline[i]+"xxx")}d?a.get("/dropdowns/"+d).then(function(a){b.meta=a.data}):a.get("/dropdowns/").then(function(a){b.meta=a.data}),a.put("/queries/count",{conditions:d}).then(function(a){b.queries_count=a.data[0].count})},e.selectTab=function(a){for(var b in f)b!==a?(angular.element(document.getElementById(b)).removeClass("active"),angular.element(document.getElementById(f[b])).addClass("ng-hide")):(angular.element(document.getElementById(b)).addClass("active"),angular.element(document.getElementById(f[b])).removeClass("ng-hide"))},e.resetSQ=function(){b.baseline={},b.baseline_type="",b.queries_count="",b.search_terms={},b.search_terms.contract={},b.search_terms.expand={},b.search_terms.exclude={},d=void 0,c=0,b.exlc_incr=0},e.getConditions=function(){return d},e.update_files=function(){var c=document.getElementById("new_files"),d="ng-show";a.get("/image_jobs/count/"+b.default_storage).then(function(e){b.img_db=e.data,a.get("/image_jobs/new_files/").then(function(a){parseInt(a.data.amount)>parseInt(b.img_db.size)&&(angular.element(c).removeClass("ng-hide"),angular.element(c).addClass(d))})})},e}]),app.factory("getGlobals",["$global",function(a){var b=a.request;return{tickers:function(){return b(a.url("tickers"))},biographies:function(){return b(a.url("biographies"))},resumes:function(){return b(a.url("resumes"))}}}]),app.factory("$global",["$http",function(a){var b={biographies:"/landing_mgmt/bios/all",tickers:"/landing_mgmt/tickers",resumes:"/landing_mgmt/projects"},c={},d={},e={},f={};return f.request=function(b){return a.get(b)},f.url=function(a){return b[a]},f.setBiographies=function(a){c=a},f.getBiographies=function(){return c},f.setTickers=function(a){d=a},f.getTickers=function(){return d},f.setResumes=function(a){e=a},f.getResumes=function(){return e},f}]),app.service("imageServices",["$http","$rootScope","appServices","capInitialFilter","eventServices",function(a,b,c,d,e){var f={};return f.getAll=function(){a.get("/images_mgmt/get_all").then(function(a){b.images=a.data})},f.getLatest=function(){a.get("/images_mgmt/get_latest").then(function(a){b.img=a.data})},f.getLatestEvent=function(){a.get("/queries/latest").then(function(a){b.event=a.data})},f.addImg=function(c,d){a.get("/exif/"+c.file).then(function(e){var g=e.data.coordinates;c.created||(c.created=e.data.created),a.get("https://maps.googleapis.com/maps/api/geocode/json?latlng="+e.data.coordinates+"&key="+e.data.API_KEY).then(function(e){"OK"===e.data.status&&(c=f.buildImageObject(c,e.data.results[0].address_components)),g&&"ZERO_RESULTS"===e.data.status&&(b.images[index].country="En Route",b.images[index].state="N/a",b.images[index].city="En Route"),a.post("/images_mgmt/add",c).then(function(a){"error"==a.data.name?b.newImages[c.file]=a.data.detail:b.newImages[c.file]=!1}).then(function(a){f.getUncategorisedImg()}).then(function(a){d?b.loadNewImages():f.getAll()})})})},f.addTags=function(b){var c={},g={};if(b.country&&"usa"===b.country.toLowerCase()&&(b.country="united states of america"),b.add_event){for(var h in b)"id"===h?g.img_id=b[h]:("event_da"===h||"event_en"===h)&&(g[h]=b[h]);a.post("/events_mgmt/add",g).then(function(a){e.getAllEvents(),f.getAll()})}if(b.add_tags){for(var h in b)"meta"!==h&&"names"!==h&&"country"!==h&&"state"!==h&&"city"!==h&&"occasion"!==h&&"id"!==h||null===b[h]||("id"!==h?c[h]=d(b[h]):c[h]=b[h]);a.put("/images_mgmt/add_meta",c).then(function(a){f.getUncategorisedImg(),f.getAll()})}},f.getUncategorisedImg=function(){a.get("/images_mgmt/get_new").then(function(a){b.uncategorized=a.data})},f.getImgById=function(c){a.get("/images_mgmt/get_one/"+c).then(function(d){b.img=d.data,a.get("/events_mgmt/get_one/"+c).then(function(a){a.data&&(b.img.event=!0)})})},f.batchEdit=function(b){var c={};b.country&&"usa"===b.country.toLowerCase()&&(c.country="united states of america");for(var e in b)b[e]&&e&&(c[e]=d(b[e]));a.post("/images_mgmt/batch",c).then(function(a){f.getUncategorisedImg(),f.getAll()})},f.getNewFiles=function(){b.newImages={};var c=document.getElementById("new_files"),d="ng-show";a.get("/image_jobs/files").then(function(a){a.data&&(b.newImages=a.data,angular.element(c).removeClass("ng-hide"),angular.element(c).addClass(d))})},f.getExifData=function(c){a.get("/exif/"+c).then(function(a){return b.exifData=a.data,!0})},f.buildImageObject=function(a,b){function c(a,b){var c,d;for(d=0;d<a.length;d++)a[d].types.forEach(function(e,f){e===b&&(c=a[d])});return c}var d=a;return c(b,"country")?d.country=c(b,"country").long_name:d.country="En Route",c(b,"administrative_area_level_1")?d.state=c(b,"country").short_name+" - "+c(b,"administrative_area_level_1").long_name:d.state="N/a",c(b,"point_of_interest")?d.meta.push(c(b,"point_of_interest").long_name):d.meta=d.meta,c(b,"locality")?c(b,"route")&&"Ellsworth Dr"===c(b,"route").short_name?d.city="Edina":d.city=c(b,"locality").long_name:d.city="En Route",d},f.deleteImages=function(b){a["delete"]("/images_mgmt/"+b).then(function(a){f.getUncategorisedImg(),f.getAll(),c.update_files()})},f}]),app.service("landingPageServices",["$http","loadServices",function(a,b){this.postTicker=function(c){a.post("/landing_mgmt/tickers",c).then(function(a){b.getTickers()})},this.postProject=function(c){a.post("/landing_mgmt/projects",c).then(function(a){b.getProjects()})},this.postBio=function(c){a.put("/landing_mgmt/bios",c).then(function(a){b.getBios()})},this.getBio=function(a){b.getBios()}}]),app.service("loadServices",["$http","$rootScope",function(a,b){this.getBios=function(){a.get("landing_mgmt/bios/all").then(function(a){b.subjects=a.data})},this.getTickers=function(){a.get("/landing_mgmt/tickers").then(function(a){b.tickers=a.data})},this.getProjects=function(){a.get("/landing_mgmt/projects").then(function(a){b.resumes=a.data})}}]),app.service("storageServices",["$http","$rootScope",function(a,b){var c={};return c.addStorage=function(b){a.post("/storages_mgmt/add",b).then(function(a){c.getStorages()})},c.deleteStorage=function(b){a["delete"]("/storages_mgmt/"+b).then(function(a){c.getStorages()})},c.getStorages=function(){a.get("/storages_mgmt/all").then(function(a){b.storages=a.data})},c.modifyStorage=function(b){a.put("/storages_mgmt/update",b).then(function(a){c.getStorages()})},c}]),app.directive("insertBio",function(){return{restrict:"EA",scope:{subject:"="},templateUrl:"views/biography.html"}}),app.directive("myAddStorageModal",function(){return{restrict:"EA"}}),app.directive("myAddTagsModal",function(){return{restrict:"EA"}}),app.directive("myBatchEditModal",function(){return{restrict:"EA"}}),app.directive("myChangePwModal",function(){return{restrict:"EA"}}),app.directive("myLatestEventModal",function(){return{restrict:"EA",templateUrl:"views/latestEvent.html"}}),app.directive("myLoginModal",function(){return{restrict:"EA"}}),app.directive("myManageStoragesModal",function(){return{restrict:"EA"}}),app.directive("myModifyStorageModal",function(){return{restrict:"EA"}}),app.directive("myMultiViewModal",function(){return{restrict:"EA",templateUrl:"views/multiView.html"}}),app.directive("myResumeModal",function(){return{restrict:"EA"}}),app.directive("mySaveImgModal",function(){return{restrict:"EA"}});